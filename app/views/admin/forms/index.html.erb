<!-- app/views/admin/forms/index.html.erb -->

<div class="page-wrapper py-5">
  <div class="container">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h1 class="page-title mb-1">Formulários</h1>
        <p class="page-subtitle">Gerencie todos os formulários criados no sistema.</p>
      </div>
      <div class="d-flex gap-2">
        <%= link_to 'Novo Formulário', new_admin_form_path,
              class: 'btn btn-primary px-4 py-2 fw-semibold' %>

        <%= link_to 'Dashboard', admin_root_path,
              class: 'btn btn-outline-secondary px-4 py-2' %>
      </div>
    </div>

    <!-- Content -->
    <% if @forms.any? %>

      <div class="card shadow-sm border-0 rounded-4">
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th>Título</th>
                  <th>Template</th>
                  <th>Turma</th>
                  <th>Status</th>
                  <th>Respostas</th>
                  <th>Prazo</th>
                  <th class="text-center">Ações</th>
                </tr>
              </thead>

              <tbody>
                <% @forms.each do |form| %>
                  <tr>

                    <!-- Title -->
                    <td>
                      <strong class="text-dark"><%= form.title %></strong>
                    </td>

                    <!-- Template -->
                    <td><%= form.form_template.name %></td>

                    <!-- Class -->
                    <td><%= form.klass.name %></td>

                    <!-- Status -->
                    <td>
                      <% status_label =
                        case form.status
                        when 'draft' then ['Rascunho', 'secondary']
                        when 'published' then ['Publicado', 'success']
                        when 'closed' then ['Fechado', 'danger']
                        end
                      %>

                      <span class="badge bg-<%= status_label[1] %> px-3 py-2">
                        <%= status_label[0] %>
                      </span>
                    </td>

                    <!-- Responses -->
                    <td>
                      <span class="badge bg-info text-dark px-3">
                        <%= form.completed_responses.count %>
                      </span>
                      /
                      <span class="badge bg-warning text-dark px-3">
                        <%= form.klass.students.count %>
                      </span>
                    </td>

                    <!-- Due Date -->
                    <td class="text-muted">
                      <%= form.due_date.present? ? l(form.due_date, format: :short) : '-' %>
                    </td>

                    <!-- Actions -->
                    <td class="text-center">

                      <%= link_to 'Ver', admin_form_path(form),
                            class: 'btn btn-sm btn-outline-primary me-1' %>

                      <% if form.draft? %>
                        <%= link_to 'Editar', edit_admin_form_path(form),
                              class: 'btn btn-sm btn-warning me-1' %>

                        <%= button_to 'Publicar',
                              publish_admin_form_path(form),
                              method: :patch,
                              class: 'btn btn-sm btn-success',
                              form_class: 'd-inline-block' %>
                      <% end %>

                      <% if form.published? %>
                        <%= button_to 'Fechar',
                              close_admin_form_path(form),
                              method: :patch,
                              class: 'btn btn-sm btn-danger',
                              form_class: 'd-inline-block' %>
                      <% end %>

                    </td>

                  </tr>
                <% end %>
              </tbody>

            </table>
          </div>
        </div>
      </div>

    <% else %>

      <div class="alert alert-info rounded-3 shadow-sm">
        <strong>Nenhum formulário criado ainda.</strong>
        <%= link_to 'Criar seu primeiro formulário',
              new_admin_form_path,
              class: 'alert-link' %>
      </div>

    <% end %>

  </div>
</div>

<style>
  .page-wrapper {
    min-height: 100vh;
    background: #f5f8fc;
  }

  .page-title {
    font-size: 2rem;
    font-weight: 700;
    color: #22314f;
  }

  .page-subtitle {
    color: #5f6b7c;
    margin-top: -0.25rem;
  }

  table thead th {
    font-weight: 600;
    color: #2f3b52;
  }

  .table-hover tbody tr:hover {
    background-color: #f0f4fa !important;
  }

  .badge {
    font-size: 0.85rem;
  }
</style>
