<!-- app/views/admin/form_templates/new.html.erb -->

<div class="page-wrapper py-5">
  <div class="container">
    
    <!-- Header Section -->
    <div class="page-header mb-4">
      <h1 class="page-title">Novo Template de Formulário</h1>
      <p class="page-subtitle">Crie e personalize modelos com campos dinâmicos.</p>
    </div>

    <!-- Main Card -->
    <div class="card shadow-lg rounded-4 border-0 p-4 mb-5">

      <%= form_with(model: [:admin, @form_template], local: true, method: :post) do |form| %>

        <% if @form_template.errors.any? %>
          <div class="alert alert-danger rounded-3 shadow-sm">
            <h5 class="fw-bold mb-2"><%= pluralize(@form_template.errors.count, "erro") %> encontrado(s):</h5>
            <ul class="mb-0 ps-3">
              <% @form_template.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <!-- Name -->
        <div class="form-section mb-4">
          <%= form.label :name, "Nome do Template", class: "form-label fw-semibold" %>
          <%= form.text_field :name, class: "form-control form-control-lg", placeholder: "Ex: Avaliação de Desempenho" %>
        </div>

        <!-- Description -->
        <div class="form-section mb-4">
          <%= form.label :description, "Descrição", class: "form-label fw-semibold" %>
          <%= form.text_area :description, class: "form-control", rows: 4, placeholder: "Descreva o propósito deste template..." %>
        </div>

        <!-- Fields Section -->
        <h3 class="section-title mt-4 mb-3">Campos do Template</h3>

        <div id="fields-container" class="field-list">
          <%= form.fields_for :form_template_fields do |field_form| %>
            <%= render 'form_template_field_form', f: field_form %>
          <% end %>
        </div>

        <button type="button" class="btn btn-add-field mb-4" onclick="addField()">
          + Adicionar Campo
        </button>

        <!-- Buttons -->
        <div class="d-flex gap-3 mt-4">
          <%= form.submit "Criar Template", class: "btn btn-primary btn-lg px-4" %>
          <%= link_to "Cancelar", admin_form_templates_path, class: "btn btn-outline-secondary btn-lg px-4" %>
        </div>

      <% end %>

    </div>
  </div>
</div>

<!-- Custom Styles -->
<style>
  .page-wrapper {
    background: #f5f8fc;
    min-height: 100vh;
  }

  .page-header .page-title {
    font-size: 2rem;
    font-weight: 700;
    color: #22314f;
  }

  .page-subtitle {
    color: #5f6b7c;
    margin-top: -0.5rem;
  }

  .card {
    background: #fff;
  }

  .section-title {
    font-size: 1.4rem;
    font-weight: 600;
    color: #2f4b77;
  }

  .btn-add-field {
    background: #0d6efd;
    color: white;
    border-radius: 50px;
    padding: 0.55rem 1.4rem;
    font-weight: 500;
    transition: 0.2s;
  }

  .btn-add-field:hover {
    background: #0b5cd6;
  }

  /* Field Item Card */
  .field-item.card {
    border-left: 4px solid #0d6efd;
    border-radius: 12px;
  }
</style>

<script>
function addField() {
  const container = document.getElementById('fields-container');
  const newId = new Date().getTime();

  const fieldHtml = `
    <div class="card field-item p-3 mb-3 shadow-sm">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">Posição</label>
          <input class="form-control" min="1"
                 name="form_template[form_template_fields_attributes][${newId}][position]"
                 type="number">
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">Tipo de Campo</label>
          <select class="form-select"
                  name="form_template[form_template_fields_attributes][${newId}][field_type]">
            <option value="">Selecione</option>
            <option>text</option>
            <option>textarea</option>
            <option>email</option>
            <option>number</option>
            <option>date</option>
            <option>select</option>
            <option>radio</option>
            <option>checkbox</option>
          </select>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label fw-semibold">Rótulo do Campo</label>
        <input class="form-control" placeholder="Ex: Seu Nome"
               name="form_template[form_template_fields_attributes][${newId}][label]"
               type="text">
      </div>

      <div class="mb-3">
        <label class="form-label fw-semibold">Opções (JSON)</label>
        <small class="text-muted d-block mb-1">Só para select/radio/checkbox</small>
        <textarea class="form-control" rows="2"
                  placeholder='["Opção 1", "Opção 2"]'
                  name="form_template[form_template_fields_attributes][${newId}][options]">
        </textarea>
      </div>

      <div class="form-check">
        <input class="form-check-input"
               name="form_template[form_template_fields_attributes][${newId}][required]"
               type="checkbox" value="1" id="required_${newId}">
        <label class="form-check-label" for="required_${newId}">
          Campo obrigatório?
        </label>
      </div>
    </div>
  `;

  container.insertAdjacentHTML('beforeend', fieldHtml);
}
</script>
