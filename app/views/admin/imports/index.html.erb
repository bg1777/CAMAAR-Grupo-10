<!-- app/views/admin/imports/index.html.erb -->

<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Importar Dados do SIGAA</h1>
    <%= link_to 'Sair', destroy_user_session_path, method: :delete, class: 'btn btn-danger' %>
  </div>

  <!-- Alertas -->
  <% if notice.present? %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <%= notice %>
      <button type="button" class="close" data-dismiss="alert" aria-label="Close" onclick="this.closest('.alert').remove();>
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
  <% end %>

  <% if alert.present? %>
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
      <%= simple_format(alert) %>
      <button type="button" class="close" data-dismiss="alert" aria-label="Close" onclick="this.closest('.alert').remove();>
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
  <% end %>

  <!-- Cards de Status -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Total de Turmas</h5>
          <p class="card-text">
            <span class="badge bg-primary" style="font-size: 1.5rem;">
              <%= @total_klasses %>
            </span>
          </p>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Total de Alunos</h5>
          <p class="card-text">
            <span class="badge bg-success" style="font-size: 1.5rem;">
              <%= @total_users %>
            </span>
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Formul√°rio de Upload -->
  <div class="card">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">üì§ Importar Arquivo JSON</h5>
    </div>
    <div class="card-body">
      <%= form_with url: import_klasses_admin_imports_path, method: :post, local: true, multipart: true do |f| %>
        <div class="mb-3">
          <label for="file" class="form-label">
            <strong>Selecione o arquivo JSON (class_members.json)</strong>
          </label>
          <%= f.file_field :file, class: 'form-control', accept: '.json', required: true %>
          <small class="form-text text-muted">
            Formato: JSON com estrutura de turmas e alunos do SIGAA
          </small>
        </div>

        <div class="mb-3">
          <div class="alert alert-info" role="alert">
            <strong>‚ÑπÔ∏è Informa√ß√µes:</strong>
            <ul class="mb-0">
              <li>As senhas dos alunos ser√£o suas matr√≠culas</li>
              <li>Alunos j√° existentes n√£o ser√£o duplicados</li>
              <li>Turmas j√° existentes ser√£o atualizadas</li>
              <li>Alunos duplicados em turmas n√£o ser√£o adicionados novamente</li>
            </ul>
          </div>
        </div>

        <div class="d-grid gap-2">
          <%= f.submit "üöÄ Importar Turmas e Alunos", class: 'btn btn-primary btn-lg' %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Instru√ß√µes -->
  <div class="card mt-4">
    <div class="card-header">
      <h5 class="mb-0">üìã Instru√ß√µes de Uso</h5>
    </div>
    <div class="card-body">
      <h6>Estrutura do arquivo JSON esperada:</h6>
      <pre><code>[
  {
    "code": "CIC0097",
    "name": "BANCOS DE DADOS",
    "class": {
      "classCode": "TA",
      "semester": "2021.2",
      "time": "35T45"
    },
    "dicente": [
      {
        "nome": "Ana Clara Jordao Perna",
        "curso": "CI√äNCIA DA COMPUTA√á√ÉO/CIC",
        "matricula": "190084006",
        "usuario": "190084006",
        "formacao": "graduando",
        "ocupacao": "dicente",
        "email": "acjpjvjp@gmail.com"
      }
    ]
  }
]</code></pre>

      <h6 class="mt-3">Ap√≥s a importa√ß√£o:</h6>
      <ul>
        <li>‚úÖ Turmas ser√£o criadas/atualizadas</li>
        <li>‚úÖ Alunos ser√£o criados com sua matr√≠cula como senha inicial</li>
        <li>‚úÖ Alunos ser√£o vinculados √†s turmas</li>
        <li>‚ÑπÔ∏è Qualquer erro ser√° reportado para verifica√ß√£o</li>
      </ul>

      <h6 class="mt-3">Acesso dos alunos:</h6>
      <ul>
        <li><strong>Email:</strong> conforme especificado no JSON</li>
        <li><strong>Senha:</strong> sua matr√≠cula (ex: 190084006)</li>
        <li>‚ö†Ô∏è Aluno pode mudar a senha ap√≥s primeiro login</li>
      </ul>
    </div>
  </div>

  <!-- Bot√£o Voltar -->
  <div class="mt-4">
    <%= link_to '‚Üê Voltar ao Dashboard', admin_root_path, class: 'btn btn-secondary' %>
  </div>
</div>

<style>
  pre {
    background-color: #f5f5f5;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 12px;
    overflow-x: auto;
  }

  code {
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
  }

  .alert ul {
    padding-left: 20px;
  }

  .alert li {
    margin-bottom: 0.5rem;
  }
</style>
