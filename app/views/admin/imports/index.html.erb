<!-- app/views/admin/imports/index.html.erb -->

<div class="container mt-5">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-start mb-4">
    <div>
      <h1 class="mb-1">Importar Dados do SIGAA</h1>
      <p class="text-muted mb-0">
        Gerencie a importa√ß√£o de turmas e alunos a partir do JSON do SIGAA
      </p>
    </div>

    <%= link_to 'Sair',
      destroy_user_session_path,
      method: :delete,
      class: 'btn btn-outline-danger'
    %>
  </div>

  <!-- Status Cards -->
  <div class="row g-4 mb-4">
    
    <div class="col-md-6">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body">
          <h5 class="card-title text-primary mb-2">Total de Turmas</h5>
          <span class="badge bg-primary px-3 py-2" style="font-size: 1.4rem;">
            <%= @total_klasses %>
          </span>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body">
          <h5 class="card-title text-success mb-2">Total de Alunos</h5>
          <span class="badge bg-success px-3 py-2" style="font-size: 1.4rem;">
            <%= @total_users %>
          </span>
        </div>
      </div>
    </div>

  </div>

  <!-- Upload Form -->
  <div class="card shadow-sm border-0">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">üì§ Importar Arquivo JSON</h5>
    </div>

    <div class="card-body">

      <%= form_with url: import_klasses_admin_imports_path,
                    method: :post,
                    local: true,
                    multipart: true do |f| %>

        <!-- File Input -->
        <div class="mb-4">
          <label class="form-label fw-semibold">
            Selecione o arquivo JSON (class_members.json)
          </label>

          <%= f.file_field :file,
                class: 'form-control',
                accept: '.json',
                required: true %>

          <small class="text-muted d-block mt-1">
            O arquivo deve seguir a estrutura oficial do SIGAA.
          </small>
        </div>

        <!-- Info Box -->
        <div class="alert alert-info mb-4 shadow-sm">
          <strong class="mb-2 d-inline-block">‚ÑπÔ∏è Informa√ß√µes Importantes</strong>

          <ul class="mb-0 ms-2">
            <li>As senhas dos alunos ser√£o suas matr√≠culas.</li>
            <li>Alunos j√° existentes n√£o ser√£o duplicados.</li>
            <li>Turmas existentes ser√£o atualizadas.</li>
            <li>Alunos repetidos na mesma turma ser√£o ignorados.</li>
          </ul>
        </div>

        <!-- Submit -->
        <div class="d-grid">
          <%= f.submit "üöÄ Importar Turmas e Alunos",
                class: 'btn btn-primary btn-lg' %>
        </div>

      <% end %>

    </div>
  </div>

  <!-- Instructions -->
  <div class="card shadow-sm border-0 mt-4">
    <div class="card-header bg-light">
      <h5 class="mb-0">üìã Instru√ß√µes de Uso</h5>
    </div>

    <div class="card-body">

      <h6 class="fw-bold">Estrutura esperada do JSON:</h6>

      <pre><code>[
  {
    "code": "CIC0097",
    "name": "BANCOS DE DADOS",
    "class": {
      "classCode": "TA",
      "semester": "2021.2",
      "time": "35T45"
    },
    "dicente": [
      {
        "nome": "Ana Clara Jordao Perna",
        "curso": "CI√äNCIA DA COMPUTA√á√ÉO/CIC",
        "matricula": "190084006",
        "usuario": "190084006",
        "formacao": "graduando",
        "ocupacao": "dicente",
        "email": "acjpjvjp@gmail.com"
      }
    ]
  }
]</code></pre>

      <h6 class="mt-4 fw-bold">Ap√≥s a importa√ß√£o:</h6>
      <ul>
        <li>‚úÖ Turmas ser√£o criadas ou atualizadas.</li>
        <li>‚úÖ Alunos receber√£o senha inicial igual √† matr√≠cula.</li>
        <li>‚úÖ Alunos ser√£o vinculados √†s suas turmas.</li>
        <li>‚ÑπÔ∏è Erros ou inconsist√™ncias ser√£o informados.</li>
      </ul>

      <h6 class="mt-4 fw-bold">Acesso dos alunos:</h6>
      <ul>
        <li><strong>Email:</strong> conforme especificado no JSON.</li>
        <li><strong>Senha:</strong> matr√≠cula (ex: 190084006).</li>
        <li>‚ö†Ô∏è Recomenda-se que o aluno altere a senha no primeiro acesso.</li>
      </ul>

    </div>
  </div>

  <!-- Back Button -->
  <div class="mt-4">
    <%= link_to '‚Üê Voltar ao Dashboard',
          admin_root_path,
          class: 'btn btn-secondary' %>
  </div>
</div>

<!-- Custom Styling for JSON block -->
<style>
  pre {
    background-color: #f8f9fa;
    border-radius: 6px;
    padding: 14px;
    border: 1px solid #dee2e6;
    overflow-x: auto;
  }

  code {
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
  }
</style>
